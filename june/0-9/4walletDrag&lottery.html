<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="UTF-8">
	<title>手机侧边红包拖拽效果</title>
	<script>
		var scale=1/window.devicePixelRatio;
		document.write("<meta name='viewport' content='width=device-width, user-scalable=no, initial-scale="+scale+", maximum-scale="+scale+", minimum-scale="+scale+"'>")
		var html=document.getElementsByTagName("html")[0];
        html.style.fontSize=document.documentElement.clientWidth/16+"px";
	</script>
	<style>
		*{margin:0;padding:0;border:0;outline:none;-webkit-box-sizing:border-box;box-sizing:border-box;}
		a{-webkit-tap-highlight-color:transparent;text-decoration:none; color:#333;}
		input{-webkit-appearance:none;}
		ul,li{list-style:none;}
		/*public*/
		.fl{float:left;}
		.fr{float:right;}
		body{font-size:0.5rem;}
		.clearfix:after{height: 0;line-height: 0;content:"";visibility:hidden;clear:both;display:block;}
		.wrap{width: 16rem;margin:0 auto;}
		.head{width: 16rem;height: 2.5rem;border:1px solid green;position: fixed;top:0;text-align:center;}
		.foot{width: 16rem;height: 3rem;background-color:#f1f1f1;position: fixed;bottom:0;text-align:center;}
		.main{width: 16rem;height: 20rem;margin-top:2.5rem;}
		@-webkit-keyframes shake{
			0%{
				transform:rotate(-30deg);
			}50%{
				transform:rotate(30deg);
			}100%{
				transform:rotate(-30deg);
			}
		} 
		.wallet{position: fixed;top:70%;right:0;width: 2rem;height: 2rem;-webkit-animation:1s shake linear infinite;}
		.wallet a{display:block;width: 100%;height: 100%;}
		.wallet a img{display:block;width: 100%;height: 100%;}
		/*抽奖------*/
		.bg{width: 100%;height: 100%;background:rgba(0,0,0,0.6);position: absolute;left:0;top:0;display:none;}
		.bg>i{position: absolute;right:0.2rem;top:0.2rem;font-style:normal;color:red;font-size:1.2rem;}
		.bg>a{position: absolute;top:-4rem;left:-3rem;width: 6rem;height: 6rem;transform:rotate(-40deg);line-height: 10.5rem;color:white;background-color:red;font-size:1rem;text-indent:1.5rem;}
		.bg>ol{width: 10rem;height: 5rem;overflow:auto;background-color:white;border-radius:0.5rem;position: absolute;left:50%;top:0;margin-left:-5rem;display:none;}
		.bg>ol>i{position: absolute;right:0.1rem;top:0.1rem;font-style:normal;color:#000;font-size:0.8rem;}
		.bg>ol>li{width: 100%;height: 1rem;border-bottom:0.025rem dashed green;line-height:1rem;font-size:0.7rem;color:red;text-align:center;list-style-type:disc;list-style-position:inside;}
		.bg .cj{width: 14rem;height: 14rem;margin:5rem auto;position: relative;}
		.bg .cj i{width: 100%;height: 100%;position: absolute;top:0;left:0;background:url(img/cj.png) no-repeat;background-size:100%;transform:rotate(8deg);}
		.bg .cj div{position: absolute;height: 7rem;width: 3.4rem;left:50%;margin-left:-1.7rem;top:1.2rem;font-size:0.7rem;transform-origin: center 83%;}
		.bg .cj .rotate{width: 3.6rem;height: 3.6rem;position: absolute;z-index:2;top:50%;left:50%;margin-left:-1.8rem;margin-top:-1.8rem;}
		.bg .cj .rotate img{display:block;width: 100%;height: 100%;}
		.bg .cj .alert{position: absolute;top:10rem;left:50%;width: 10rem;height: 6rem;margin-left:-5rem;border-radius:0.5rem;overflow:hidden;background:rgba(255,0,0,0.9);display:none;}
		.bg .cj .alert span:nth-of-type(1){width: 100%;height: 50%;display:block;color:white;font:400 0.7rem/3rem MicroSoft Yahei;text-align:center;}
		.bg .cj .alert a{width: 100%;height: 50%;display:block;font:700 1rem/3rem MicroSoft Yahei;text-align:center;color:#f40;background-color:#f1f1f1;}
		.bg .cj .alert span .selected{font-weight:normal;}
		.bg .cj .alert>b{position: absolute;top:0.2rem;right:0.2rem;color:black;border-radius:50%;}
	</style>
</head>
<body>
	<div class="wrap">
		<header class="head">头部</header>
		<section class="main">
		<p>主题</p>
		<div class="bg">
			<a id="jchi" href="javascript:;">奖池</a>
			<ol id="jchi-con">
			<i id="jchi-con-close">×</i>
			</ol>
			<i id="b-close">×</i>
			<div class="cj">
				<i></i>
				<div><span>一元现金</span></div>
				<div><span>二元现金</span></div>
				<div><span>三元现金</span></div>
				<div><span>四元现金</span></div>
				<div><span>五元现金</span></div>
				<div><span>六元现金</span></div>
				<div><span>七元现金</span></div>
				<div><span>八元现金</span></div>
				<div><span>九元现金</span></div>
				<div class="rotate">
					<img id="rot" src="img/rotate.png">
					<!-- <strong>点击抽奖</strong> -->
				</div>
				<div class="alert">
					<b class="close">×</b>
					<span>恭喜你中了<b class="selected"></b></span>
					<a href="http://www.baidu.com">去领取</a>
				</div>
			</div>
		</div>

		</section>
		<footer class="foot">尾部</footer>
		<div class="wallet">
			<a href="#"><img src="img/wallet.png"></a>
		</div>
	</div>
	<script src="js/zoe.js"></script>
	<script src="js/rotate.js"></script>
	<script>
		window.onload=function(){
			window.onresize=function(){
				window.location.reload();
			}
			var W=document.documentElement.clientWidth;
			var oDiv=document.querySelector(".wallet");
			oDiv.addEventListener("touchstart",function(e){
				e.preventDefault();
				var e=e.targetTouches[0];
				var disX=e.clientX;
				var disY=e.clientY;
				var tempX=disX-this.offsetLeft;
				var tempY=disY-this.offsetTop;
				var lastLeft=0;
				oDiv.addEventListener("touchmove",function(e){
					e.preventDefault();
					var e=e.targetTouches[0];
					var left1=e.clientX-tempX;
                    var top1=e.clientY-tempY;
                    this.style.left=left1+"px";
                    this.style.top=top1+"px";
                    lastLeft=left1;
				})
				oDiv.addEventListener("touchend",function(e){
					if(lastLeft>W/2){
						perfectMove(oDiv,{"left":W-oDiv.offsetWidth});
					}else{
						perfectMove(oDiv,{"left":0});
					}
					oBg.style.display="block";
					oBclose.addEventListener("touchend",function(){
						oBg.style.display="none";
					})
					oJchi.addEventListener("touchend",function(){
						oJchiCon.style.display="block";
					})
					oJchiConClose.addEventListener("touchend",function(){
						oJchiCon.style.display="none";
					})
				})
			})



			//抽奖---------------
			var aSdiv=document.querySelector(".cj").querySelectorAll("div");
			var oBg=document.querySelector(".bg");
			var oBclose=document.querySelector(".bg").querySelector("#b-close");
			var oJchi=document.querySelector(".bg").querySelector("#jchi");
			var oJchiCon=document.querySelector(".bg").querySelector("#jchi-con");
			var oJchiConClose=document.querySelector(".bg").querySelector("#jchi-con-close");
			for(var i=0;i<aSdiv.length-2;i++){
				aSdiv[i].style.transform="rotate("+i*40+"deg)"
			}
			var oImg=document.querySelector("#rot");
			var oAlert=document.querySelector(".alert")
			var oSelect=document.querySelector(".alert").querySelector(".selected");
			var oClose=document.querySelector(".alert").querySelector(".close");
			var oOpen=document.querySelector(".alert").querySelector("a");
			//来个开关
			var onOff=0;
			oImg.addEventListener("touchend",zhuan,false);
			function zhuan(e){
				e.preventDefault();
				if(onOff)return;
				onOff=1;
				var deg=Math.floor(Math.random()*9)*40+2160;
				var op={
					"elem":"#rot",
					"style":"rotate",
					"target":deg,
					"time":3000,
					"type":"easeOutStrong",
					"callback":function(){
						// oImg.removeEventListener("touchend",zhuan,false);
						oAlert.style.display="block";
						var num=(deg-2160)/40;
						oSelect.innerHTML=aSdiv[num].children[0].innerHTML
						onOff=0;
						oClose.addEventListener("touchend",function(){
							oAlert.style.display="none";
							// oBg.style.display="none";
						})
						var Li=document.createElement("li");
						Li.innerHTML=aSdiv[num].children[0].innerHTML
						if(oJchiCon.children[1]){
							oJchiCon.insertBefore(Li, oJchiCon.children[1]);
						}else{
							oJchiCon.appendChild(Li);
						}
						oJchiCon.style.display="block";
					}
				}
				new Rotate(op).Go();
			}

		}
	</script>
</body>
</html>