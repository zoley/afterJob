<html lang="zh-CN"><head>
    <!--去掉 begin -->
<!--        <link rel="stylesheet" href="--><!--/style/style.css">-->
    <!--去掉 end -->
    <meta charset="UTF-8">
    <title>辛巴网盟-广告商后台</title>
    <link rel="shortcut icon" type="image/x-icon" href="/templates/main/img/ico.ico">
    <link rel="stylesheet" href="css/home.css">
</head>

<body>
<header id="head" class="wrap">

    <a href="/index.php?e=adv/ad.create&amp;planid=" class="new-set fr">新建广告</a>
    <div class="ico fr">
        <a href="/index.php?e=adv/msg.get_list" title="消息中心"><i></i></a>
        <a href="javascript:;">
            <i></i>
            <ul class="ico-issue">
                <li onclick="window.location.href='/index.php?e=index.help'">常见问题</li>
                <li onclick="window.location.href='/index.php?e=index.article_list'">最新公告</li>
                <li onclick="window.location.href='/index.php?e=index.help'">反馈意见</li>
                <li onclick="window.location.href='/index.php'">咨询客服</li>
            </ul>
        </a>
        <!-- <a href="javascript:;"><i></i></a> -->
    </div>
            <a href="http://wpa.qq.com/msgrd?v=3&amp;uin=984204&amp;site=qq&amp;menu=yes" target="_blank" class="contact fr"><i></i>专属客服</a>
    </header>
<div id="main" class="wrap" style="height: 985px;"><div id="side-bar">
    <div class="logo">
        <div></div>
        <h1>辛巴网盟</h1>
    </div>
    <div class="personal">
        <div class="photo"><img id="photo" src="/templates/main/img/photo.jpg" alt="头像"></div>
        <div class="user">
            <span id="userid">qiba</span>
            <div class="setting">
                <a href="/index.php?e=adv/account.get_list">账户设置</a>
                <a href="/index.php?e=main/main.logout&amp;id=11413">立即注销</a>
            </div>
        </div>
    </div>
    <a href="/index.php?e=adv/index.get_list"><i></i>平台概况</a>
    <a href="/index.php?e=adv/plan.get_list"><i></i>计划管理</a>
    <a class="active" href="/index.php?e=adv/ad.get_list"><i></i>广告管理</a>
    <a href="/index.php?e=adv/report.get_list&amp;type=&amp;timerange=2017-08-10_2017-08-10"><i></i>效果报告</a>
    <a href="/index.php?e=adv/paylog.get_list"><i></i>充值记录</a>
    <a href="/index.php?e=adv/msg.get_list"><i></i>消息中心</a>
</div>
<div id="change-photo">
    <h2>修改头像</h2>
    <ul>
        <li class="active"><img src="/templates/main/img/photo/1.png" val="/img/photo/1.png" alt=""></li>
        <li><img src="/templates/main/img/photo/2.png" val="/img/photo/2.png" alt=""></li>
        <li><img src="/templates/main/img/photo/3.png" val="/img/photo/3.png" alt=""></li>
        <li><img src="/templates/main/img/photo/4.png" val="/img/photo/4.png" alt=""></li>
        <li><img src="/templates/main/img/photo/5.png" val="/img/photo/5.png" alt=""></li>
        <li><img src="/templates/main/img/photo/6.png" val="/img/photo/6.png" alt=""></li>
        <li><img src="/templates/main/img/photo/7.png" val="/img/photo/7.png" alt=""></li>
        <li><img src="/templates/main/img/photo/8.png" val="/img/photo/8.png" alt=""></li>
        <li><img src="/templates/main/img/photo/9.png" val="/img/photo/9.png" alt=""></li>
        <li><img src="/templates/main/img/photo/10.png" val="/img/photo/10.png" alt=""></li>
        <li><img src="/templates/main/img/photo/11.png" val="/img/photo/11.png" alt=""></li>
        <li><img src="/templates/main/img/photo/12.png" val="/img/photo/12.png" alt=""></li>
        <li><img src="/templates/main/img/photo/13.png" val="/img/photo/13.png" alt=""></li>
        <li><img src="/templates/main/img/photo/14.png" val="/img/photo/14.png" alt=""></li>
        <li><img src="/templates/main/img/photo/15.png" val="/img/photo/15.png" alt=""></li>
        <li><img src="/templates/main/img/photo/16.png" val="/img/photo/16.png" alt=""></li>
        <li><img src="/templates/main/img/photo/17.png" val="/img/photo/17.png" alt=""></li>
        <li><img src="/templates/main/img/photo/18.png" val="/img/photo/18.png" alt=""></li>
        <li><img src="/templates/main/img/photo/19.png" val="/img/photo/19.png" alt=""></li>
        <li><img src="/templates/main/img/photo/20.png" val="/img/photo/20.png" alt=""></li>
        <li><img src="/templates/main/img/photo/21.png" val="/img/photo/21.png" alt=""></li>
        <li><img src="/templates/main/img/photo/22.png" val="/img/photo/22.png" alt=""></li>
        <li><img src="/templates/main/img/photo/23.png" val="/img/photo/23.png" alt=""></li>
        <li><img src="/templates/main/img/photo/24.png" val="/img/photo/24.png" alt=""></li>
        <li><img src="/templates/main/img/photo/25.png" val="/img/photo/25.png" alt=""></li>
        <li><img src="/templates/main/img/photo/26.png" val="/img/photo/26.png" alt=""></li>
        <li><img src="/templates/main/img/photo/27.png" val="/img/photo/27.png" alt=""></li>
        <li><img src="/templates/main/img/photo/28.png" val="/img/photo/28.png" alt=""></li>
        <li><img src="/templates/main/img/photo/29.png" val="/img/photo/29.png" alt=""></li>
        <li><img src="/templates/main/img/photo/30.png" val="/img/photo/30.png" alt=""></li>
        <li><img src="/templates/main/img/photo/31.png" val="/img/photo/31.png" alt=""></li>
        <li><img src="/templates/main/img/photo/32.png" val="/img/photo/32.png" alt=""></li>
        <li><img src="/templates/main/img/photo/33.png" val="/img/photo/33.png" alt=""></li>
        <li><img src="/templates/main/img/photo/34.png" val="/img/photo/34.png" alt=""></li>
        <li><img src="/templates/main/img/photo/35.png" val="/img/photo/35.png" alt=""></li>
        <li><img src="/templates/main/img/photo/36.png" val="/img/photo/36.png" alt=""></li>
        <li><img src="/templates/main/img/photo/37.png" val="/img/photo/37.png" alt=""></li>
        <li><img src="/templates/main/img/photo/38.png" val="/img/photo/38.png" alt=""></li>
        <li><img src="/templates/main/img/photo/39.png" val="/img/photo/39.png" alt=""></li>
        <li><img src="/templates/main/img/photo/40.png" val="/img/photo/40.png" alt=""></li>
    </ul>
    <p><input type="button" value="关闭" id="photo-cancel"><input type="button" id="photo-btn" value="提交修改"></p>
</div>
<script>
    var newsTable=document.getElementById("news-table");
    if(newsTable){
        if(newsTable.offsetHeight<h-165){
            newsTable.style.height=h-169+"px";
        }
    }
    var newsTable1=document.getElementById("news-table1");
    if(newsTable1){
        if(newsTable1.offsetHeight<h-215){
            newsTable1.style.height=h-240+"px";
        }
    }
    setInterval(function(){
        var Con=document.getElementById("content");
        var h=document.documentElement.clientHeight;
        if(Con.offsetHeight>h){
            main.style.height=Con.offsetHeight+56+"px";
        }
    },100)
    var photoChange=document.getElementById("change-photo");
    var photo=document.getElementById("photo");
    var aLi=photoChange.getElementsByTagName("li");
    var photoCancel=document.getElementById("photo-cancel");
    var photoBtn=document.getElementById("photo-btn");
    photoCancel.onclick=function(){
        photoChange.style.display="none";
    }
    photo.onclick=function(){
        photoChange.style.display="block";
    }
    var now=0;
    for (var i =0;i<aLi.length;i++){
        aLi[i].index=i;
        aLi[i].onclick=function(){
            for (var i =0;i<aLi.length;i++){
                aLi[i].className="";
            }
            this.className="active";
            now=this.index;
        }
    }
    photoBtn.onclick=function(){
        photo.src=aLi[now].children[0].src;
        var phpUrl = $("#change-photo img").eq(now).attr("val");
        photoChange.style.display="none";
        var xhr=new XMLHttpRequest();
        // xhr.open("get","1php1.php?user=nishishabo&pass=123&"+new Date().getTime(),true);
        // xhr.send(null);
        xhr.open("get",'/index.php?e=adv/index.photo&id=11413&photo='+phpUrl,true);
        xhr.send(aLi[now].children[0].val);
        xhr.onreadystatechange=function(){
            if(xhr.readyState==4){
                if(xhr.status==200){
                    console.log(xhr.responseText)
                }else{
                    console.log("wrong"+xhr.status)
                }
            }
        }
    }
</script>
<script src="/templates/main/js/homead.js"></script><script type="text/javascript" src="/js/jquery/js/jquery-1.7.min.js"></script>
<script type="text/javascript" src="/js/jquery/lib/jquery-validation/jquery.validate.js"></script>
<script type="text/javascript" src="/js/jquery/lib/bigcolorpicker/js/jquery.bigcolorpicker.js"></script>
<script type="text/javascript" src="/js/jquery/lib/jquery-validation/additional-methods.js"></script>
<script type="text/javascript" src="/js/plan.js"></script>
<link rel="stylesheet" href="css/build_adverst.css">
<div id="content">
    <h2><a href="/index.php?e=adv/ad.get_list">广告管理</a>-添加广告</h2>
    <div class="con-con">
        <div class="box-title" style="background-color: #fff;">
                <span>添加广告</span>
        </div>
        <form style="background-color: #fff;" action="&#10;&#9;&#9;&#9; /index.php?e=adv/ad.create_post" method="post" enctype="multipart/form-data" name="form_b" class="form-horizontal" id="form_b">
            <input name="adsid" id="adsid" type="hidden" value="">
            <input name="height" id="height" type="hidden" value="">
            <input name="width" id="width" type="hidden" value="">


            <div class="control-group">
                <div class="box-content" style="position:relative">
                    <table width="100%" border="0" cellpadding="0" cellspacing="0" class="zone_form controls">
                        <tbody><tr class="control-group" style="border-bottom:1px dashed #dde0e3">
                            <td class="control-label">属于计划</td>
                            <td>  <select name="planid" id="planid">
                                    <option value=""> 请选择一个计划 </option>
                                                                            <optgroup label="CPC">
                                                                                            <option value="4194">&nbsp;加粉补肾&nbsp;</option>
                                                                                            <option value="4193">&nbsp;老中医加粉丝推广&nbsp;</option>
                                                                                    </optgroup>
                                                                            <optgroup label="CPM">
                                                                                    </optgroup>
                                                                            <optgroup label="CPV">
                                                                                    </optgroup>
                                                                    </select></td>
                        </tr>
                        <tr class="control-group" style="border-bottom:1px dashed #dde0e3">
                            <td class="control-label">广告类型</td>
                            <td>                                    <select name="adtplid" id="adtplid"><option value="">请选择一个</option><optgroup label="WAP广告"><option value="12" undefined="">移动插屏</option><option value="19" undefined="">移动漂浮</option><option value="21" undefined="">移动图文</option><option value="1000" undefined="">移动横幅</option><option value="1002" undefined="">移动悬浮</option><option value="1003" undefined="">互动广告</option></optgroup><optgroup label="URL直链"><option value="14" undefined="">直链广告</option></optgroup><optgroup label="PC广告"><option value="3" undefined="">右下角</option><option value="4" undefined="">上图下文</option><option value="10" undefined="">对联广告</option></optgroup></select>
                                                            </td>
                        </tr>
                        
                    </tbody></table>

                    <table width="100%" border="0" cellpadding="0" cellspacing="0" class="zone_form controls " id="wg">


                        

                    <tbody>      <tr class="add_div " id="dv_specs" style="border-bottom:1px dashed #dde0e3;height:90px"> <td class="control-label">显示尺寸</td> <td><select name="specs" id="specs"> <option value="160x120">160x120 &nbsp;&nbsp;图文横幅</option></select></td></tr> <tr class="add_div" style="border-bottom:1px dashed #dde0e3;height:100px"> <td class="control-label">上传图片</td> <td> <input type="radio" name="files" value="up" checked="">上传文件 <input type="radio" name="files" value="url">远程文件<br><span id="_up"><input type="file" class="input-27" name="imageurl"> 上传图片160x120</span> <span id="_url" style="display:none"><input style="border: 1px solid #ccc;width:400px;height:40px;margin-top:10px;" type="text" name="urlfile" id="urlfile" class="input-27"><br>远程绝对地址支持JPG,GIF,PNG,SWF,HTML（支持HTML格式文件 ）</span></td></tr> <tr class="add_div" style="border-bottom:1px dashed #dde0e3;height:100px"> <td class="control-label">标题文字</td> <td> <input style="background-color: #fff;border: 1px solid #ccc;display: inline-block;padding: 4px 6px;margin-bottom: 3px;font-size: 18px;color: #555;vertical-align: middle;border-radius: 4px;text-indent: 30px;width: 578px;height: 50px;line-height: 50px;" class="input-27" type="text" name="headline"></td></tr> <tr class="add_div" style="border-bottom:1px dashed #dde0e3;height:100px"> <td class="control-label">广告地址</td> <td> <input style="background-color: #fff;border: 1px solid #ccc;display: inline-block;padding: 4px 6px;margin-bottom: 3px;font-size: 18px;color: #555;vertical-align: middle;border-radius: 4px;text-indent: 30px;width: 578px;height: 50px;line-height: 50px;" class="input-27" type="text" name="url"></td></tr></tbody></table>

                </div>

            </div>

            <div class="form-actions" style="margin-top:60px; margin-bottom:60px">
                <button type="submit" class="btn btn-primary"> 提 交 </button>
            </div>

        </form>
    </div>
</div>
<script language="JavaScript" type="text/javascript">

    $(document).ready(function() {

        add_ad_vlt.init();


                dev = 1;
        get_adtype();
        

        $("#planid").change(function () {
            get_adtype();
        });


        $("#adtplid").change(function () {
            get_adtpl();
            add_ad_vlt.init();
        });


        function get_adtype(){
            $(".add_div").remove();
            $.ajax({
                type: "POST",
                dataType: "json",
                url: "/index.php?e=adv/ad.get_adtype",
                data: { planid: $("#planid").val()},
                success: function (data) {
                    if(data){
                        var ck,oh;
                        $("#adtplid").empty();
                        $("<option value=''>请选择一个</option>").appendTo("#adtplid");
                        $.each(data, function (i, n) {
                            if(n.tpl){
                                oh = "<optgroup label='" + n.name + "'>";
                                $.each(n.tpl, function (oi,on) {
                                    oh += "<option value=" + on.tplid + " "+ck+">" + on.name + "</option>";
                                })
                                oh += "</optgroup>";
                                $(oh).appendTo("#adtplid");  }
                        });
                    }
                }
            });

        }


        function get_adtpl(){
            var v =  $("#adtplid").val(),ah;
            $(".add_div").remove();
            $.ajax({
                type: "POST",
                dataType: "json",
                url: "/index.php?e=adv/ad.get_adtpl",
                data: { tplid: $("#adtplid").val()},
                success: function (data) {
                    if(data){
                        var hl = data.htmlcontrol;

                        if(data.specs[0]['specs'] &&　data.customspecs  ==1){
                            ah += ' <tr class="add_div " id="dv_specs" style="border-bottom:1px dashed #dde0e3;height:90px">'+
                                ' <td class="control-label">显示尺寸</td>'+
                                ' <td >'+
                                '<select name="specs" id="specs"  >';
                            $.each(data.specs , function (k, v) {
                                ah +=' <option value="'+v.specs+'"';
                                ah += '>'+v.specs+' &nbsp;&nbsp;'+v.stylename+'</option>';
                            });
                            ah +='</select></td></tr>';
                        }

                        $.each(hl.htmlcontrol_title, function (i, h) {
                            ah += ' <tr class="add_div" style="border-bottom:1px dashed #dde0e3;height:100px" >'+
                                ' <td class="control-label">'+h+'</td>'+
                                ' <td >';
                            switch (hl.htmlcontrol_type[i] ) {
                                case 'text':
                                    ah += ' <input style="background-color: #fff;border: 1px solid #ccc;display: inline-block;padding: 4px 6px;margin-bottom: 3px;font-size: 18px;color: #555;vertical-align: middle;border-radius: 4px;text-indent: 30px;width: 578px;height: 50px;line-height: 50px;" class="input-27" type = "text" name="'+hl.htmlcontrol_name[i]+'">';
                                    break;
                                case 'file':
                                    ah += ' <input type="radio" name="files" value="up"  checked>上传文件 <input type="radio" name="files" value="url"  >远程文件';
                                    //ah += '<i id="files_rand" "><input type="radio" name="files" value="rand">图库随机</i>';
                                    ah +='<br><span id="_up" ><input type = "file" class="input-27" name="imageurl" > '+hl.htmlcontrol_span[i]+'</span> <span id="_url" style="display:none"><input style="border: 1px solid #ccc;width:400px;height:40px;margin-top:10px;" type="text" name="urlfile"  id="urlfile" class="input-27"></br>远程绝对地址支持JPG,GIF,PNG,SWF,HTML（支持HTML格式文件 ）</span>';
                                    break;
                            }
                            ah +='</td></tr>';
                        });

                        $(ah).appendTo("#wg");

                        files();

                    }
                }
            });
            add_ad_vlt.init();
        }



        function files(){

            $('input:radio[name=files]').on('click', function(option) {

                var v = $(this).val();
                if (v == 'up') {
                    $('#_up').show();
                    $('#_url').hide();
                } else if (v == 'url') {
                    $('#_up').hide();
                    $('#_url').show();
                } else {
                    $('#_up').hide();
                    $('#_url').hide();
                }
            });
        }
        files();


    });


    add_ad_vlt = {
        init: function() {
            form_roles_validator = $("#form_b").validate({
                errorClass :"error",
                highlight: function(element) {
                    $(element).closest('td').addClass("f_error");
                },
                unhighlight: function(element) {
                    $(element).closest('td').removeClass("f_error");
                },
                rules: {
                    planid: {
                        required: true
                    },
                    adtplid: {
                        required: true
                    } ,
                    url: {
                        required: true,
                        url2: true
                    } ,

                    imageurl:{
                        images_file: true
                    },
                    urlfile:{
                        required: true
                    },

                    headline:{
                        required: true
                    },
                    description:{
                        required: true
                    },
                    dispurl:{
                        required: true
                    }
                },
                messages: {
                    planid:"请选择一个计划",
                    adtplid:"请选择一个广告类型",
                    url:{required:"广告地址不能为空",url2:"请填写一个正确url"},
                    htmlcode:"请正确填写",
                    imageurl:"请选择一个图片",
                    urlfile:"请正确填写",
                    htmlfile:"请正确填写",
                    headline:"请正确填写",
                    description:"请正确填写",
                    dispurl:"请正确填写"
                },
                errorElement: 'span'
            });
        }
    };
</script>

</div></body></html>